const miscFilename = 'global\\excel\\misc.txt';
const misc = D2RMM.readTsv(miscFilename);

const originalSmallPotion = misc.rows.find((row) => row.name === 'Rejuvenation Potion');
const originalFullPotion = misc.rows.find((row) => row.name === 'Full Rejuvenation Potion');

// Filter out the original potions
misc.rows = misc.rows.filter((row) => row.name !== 'Rejuvenation Potion')
misc.rows = misc.rows.filter((row) => row.name !== 'Full Rejuvenation Potion')

const changesCommon = {
    spawnable: 1,
    PermStoreItem: 1,
    multibuy: 1,
}
const changesSmallPotion = {
    cost: config.sellPriceSmall,
}

const changesFullPotion = {
    cost: config.sellPriceFull,
}

const changesCommonPotionVendors = {
    AkaraMin: 1, AkaraMax: 1, LysanderMin: 1, LysanderMax: 1, DrognanMin: 1, DrognanMax: 1, OrmusMin: 1, OrmusMax: 1,
    MalahMin: 1, MalahMax: 1, JamellaMin: 1, JamellaMax: 1,
}
const changesCommonAllVendors = {
    CharsiMin: 1, CharsiMax: 1, GheedMin: 1, GheedMax: 1, AkaraMin: 1, AkaraMax: 1, FaraMin: 1, FaraMax: 1,
    LysanderMin: 1, LysanderMax: 1, DrognanMin: 1, DrognanMax: 1, HratliMin: 1, HratliMax: 1, AlkorMin: 1, AlkorMax: 1,
    OrmusMin: 1, OrmusMax: 1, ElzixMin: 1, ElzixMax: 1, AshearaMin: 1, AshearaMax: 1, CainMin: 1, CainMax: 1,
    HalbuMin: 1, HalbuMax: 1, MalahMin: 1, MalahMax: 1, LarzukMin: 1, LarzukMax: 1, AnyaMin: 1, AnyaMax: 1,
    JamellaMin: 1, JamellaMax: 1,
}

const changesSmallPotionOnlyInHell = {
    HellUpgrade: 'rvl',
}

smallPotion = {...originalSmallPotion, ...changesCommon, ...changesSmallPotion}
fullPotion = {...originalFullPotion, ...changesCommon, ...changesFullPotion}

if (config?.fullPotionOnlyInHell) {
    smallPotion = {...smallPotion, ...changesSmallPotionOnlyInHell}
    if (config?.allVendors) {
        smallPotion = {...smallPotion, ...changesCommonAllVendors}
    } else {
        smallPotion = {...smallPotion, ...changesCommonPotionVendors}
    }
} else {
    if (config?.allVendors) {
        smallPotion = {...smallPotion, ...changesCommonAllVendors}
        fullPotion = {...fullPotion, ...changesCommonAllVendors}
    } else {
        smallPotion = {...smallPotion, ...changesCommonPotionVendors}
        fullPotion = {...fullPotion, ...changesCommonPotionVendors}
    }
}

misc.rows.push(smallPotion);
misc.rows.push(fullPotion);

D2RMM.writeTsv(miscFilename, misc);

if (config?.addCubeRecipe) {
    const cubemainFilename = 'global\\excel\\cubemain.txt';
    const cubemain = D2RMM.readTsv(cubemainFilename);

    cubemain.rows.push({
        description: 'Convert Full Healing Potion to Full Rejuvenation Potion',
        enabled: 1,
        version: 0,
        numinputs: 1,
        'input 1': `hpot`,
        output: `useitem`,
        'output b': 'rvl',
        ilvl: 1000,
        '*eol': 0,
    });
    D2RMM.writeTsv(cubemainFilename, cubemain);
}



